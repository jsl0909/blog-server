/* empty css             *//* empty css                   *//* empty css                *//* empty css               *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 */import"./el-form-item-l0sNRNKZ.js";/* empty css                 *//* empty css                  */import{d as K,v as f,I as W,H as Y,x as ee,Q as d,q as te,f as y,b as p,a as t,w as o,X as ae,J as le,N as oe,c as D,a4 as se,a5 as re,a3 as ne,L as ue,l as B,af as de,ag as ie,e as u,S as pe,F as q,z as F,T as me,ah as ce,t as E,C as fe,j as ge,g as b,a6 as _e,Z as ve,aa as ye,a2 as we,$ as be,ae as xe,s as m,_ as Ve}from"./index-BXzsnj2W.js";import{R as Ee}from"./RichEditor-Bq6E9r1x.js";import{p as I}from"./posts-Yph_4swi.js";import{c as Ie}from"./categories-DKETdLTm.js";import{t as ke}from"./tags-Cn0cmVPH.js";const Ce={class:"edit-post"},he={class:"card-header"},De={key:0,class:"post-info"},Be={key:0},Ne={key:1},Re=K({__name:"EditPost",setup(Le){const w=te(),P=W(),k=f(),C=f(!1),g=f(!1),h=f(!1),x=f([]),V=f([]),i=f(null),_=Number(P.params.id),l=Y({title:"",content:"",excerpt:"",status:"draft",categoryId:void 0,tagIds:[]}),M={title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:100,message:"标题长度在 1 到 100 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"}],status:[{required:!0,message:"请选择发布状态",trigger:"change"}]},N=a=>new Date(a).toLocaleString("zh-CN"),R=a=>{const e=a.replace(/<[^>]*>/g,"");return e.length>150?e.substring(0,150)+"...":e},L=async()=>{var a,e;try{const n=(await I.getById(_)).data;if(!n){d.error("文章不存在"),w.push("/admin/posts");return}i.value=n,l.title=n.title,l.content=n.content,l.excerpt=n.excerpt||"",l.status=n.status,l.categoryId=(a=n.category)==null?void 0:a.id,l.tagIds=((e=n.tags)==null?void 0:e.map(v=>v.tag?v.tag.id:v.id))||[]}catch(s){console.error("获取文章详情失败:",s),d.error("获取文章详情失败"),w.push("/admin/posts")}},$=async()=>{var a,e;if(k.value)try{await k.value.validate(),g.value=!0;const s={...l,status:l.status,excerpt:l.excerpt||R(l.content)};await I.update(_,s),d.success("文章更新成功"),w.push("/admin/posts")}catch(s){console.error("更新文章失败:",s),d.error(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||"更新文章失败")}finally{g.value=!1}},z=async()=>{var a,e;if(!l.title.trim()){d.warning("请至少输入文章标题");return}try{g.value=!0;const s={...l,status:"draft",excerpt:l.excerpt||R(l.content)};await I.update(_,s),d.success("草稿保存成功"),await L()}catch(s){console.error("保存草稿失败:",s),d.error(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||"保存草稿失败")}finally{g.value=!1}},j=async()=>{var a,e;try{await xe.confirm("确定要删除这篇文章吗？删除后无法恢复。","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),h.value=!0,await I.delete(_),d.success("文章删除成功"),w.push("/admin/posts")}catch(s){if(s==="cancel")return;console.error("删除文章失败:",s),d.error(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||"删除文章失败")}finally{h.value=!1}},G=async()=>{try{const a=await Ie.getList();a&&a.data?x.value=a.data.categories||a.data||[]:x.value=[]}catch(a){x.value=[],console.error("获取分类列表失败:",a)}},H=async()=>{try{const a=await ke.getList();a&&a.data?V.value=a.data.tags||a.data||[]:V.value=[]}catch(a){V.value=[],console.error("获取标签列表失败:",a)}};return ee(async()=>{if(!_||isNaN(_)){d.error("无效的文章ID"),w.push("/admin/posts");return}C.value=!0;try{await Promise.all([L(),G(),H()])}finally{C.value=!1}}),(a,e)=>{const s=ge,n=fe,v=ue,c=ne,S=re,U=ie,J=de,A=me,T=pe,O=ce,Q=se,X=ae,Z=oe;return m(),y("div",Ce,[e[19]||(e[19]=p("div",{class:"edit-header-gradient"},null,-1)),t(X,{class:"edit-card"},{header:o(()=>[p("div",he,[e[8]||(e[8]=p("span",null,"编辑文章",-1)),t(n,{onClick:e[0]||(e[0]=r=>a.$router.go(-1)),type:"text"},{default:o(()=>[t(s,null,{default:o(()=>[t(b(be))]),_:1}),e[7]||(e[7]=u(" 返回 "))]),_:1,__:[7]})])]),default:o(()=>[le((m(),D(b(we),{ref_key:"formRef",ref:k,model:l,rules:M,"label-width":"80px",class:"edit-form"},{default:o(()=>[t(Q,{gutter:20},{default:o(()=>[t(S,{span:16,class:"main-form-col"},{default:o(()=>[t(c,{label:"文章标题",prop:"title"},{default:o(()=>[t(v,{modelValue:l.title,"onUpdate:modelValue":e[1]||(e[1]=r=>l.title=r),placeholder:"请输入文章标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(c,{label:"文章内容",prop:"content"},{default:o(()=>[t(Ee,{modelValue:l.content,"onUpdate:modelValue":e[2]||(e[2]=r=>l.content=r),height:"500px",placeholder:"请输入文章内容..."},null,8,["modelValue"])]),_:1}),t(c,{label:"文章摘要"},{default:o(()=>[t(v,{modelValue:l.excerpt,"onUpdate:modelValue":e[3]||(e[3]=r=>l.excerpt=r),type:"textarea",rows:3,placeholder:"请输入文章摘要，留空则自动生成",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),t(S,{span:8,class:"side-form-col"},{default:o(()=>[t(c,{label:"发布状态",prop:"status"},{default:o(()=>[t(J,{modelValue:l.status,"onUpdate:modelValue":e[4]||(e[4]=r=>l.status=r)},{default:o(()=>[t(U,{value:"draft"},{default:o(()=>e[9]||(e[9]=[u("草稿")])),_:1,__:[9]}),t(U,{value:"published"},{default:o(()=>e[10]||(e[10]=[u("发布")])),_:1,__:[10]})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"文章分类"},{default:o(()=>[t(T,{modelValue:l.categoryId,"onUpdate:modelValue":e[5]||(e[5]=r=>l.categoryId=r),placeholder:"选择分类",clearable:"",style:{width:"100%"}},{default:o(()=>[(m(!0),y(q,null,F(x.value,r=>(m(),D(A,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"文章标签"},{default:o(()=>[t(T,{modelValue:l.tagIds,"onUpdate:modelValue":e[6]||(e[6]=r=>l.tagIds=r),multiple:"",placeholder:"选择标签",style:{width:"100%"},class:"tag-select"},{default:o(()=>[(m(!0),y(q,null,F(V.value,r=>(m(),D(A,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i.value?(m(),y("div",De,[t(O,null,{default:o(()=>e[11]||(e[11]=[u("文章信息")])),_:1,__:[11]}),p("p",null,[e[12]||(e[12]=p("strong",null,"创建时间：",-1)),u(E(N(i.value.createdAt)),1)]),p("p",null,[e[13]||(e[13]=p("strong",null,"更新时间：",-1)),u(E(N(i.value.updatedAt)),1)]),i.value.author?(m(),y("p",Be,[e[14]||(e[14]=p("strong",null,"作者：",-1)),u(E(i.value.author.nickname||i.value.author.username),1)])):B("",!0),i.value.viewCount?(m(),y("p",Ne,[e[15]||(e[15]=p("strong",null,"阅读量：",-1)),u(E(i.value.viewCount),1)])):B("",!0)])):B("",!0),t(c,null,{default:o(()=>[t(n,{type:"primary",onClick:$,loading:g.value,class:"main-btn"},{default:o(()=>[t(s,null,{default:o(()=>[t(b(_e))]),_:1}),e[16]||(e[16]=u(" 保存文章 "))]),_:1,__:[16]},8,["loading"]),t(n,{onClick:z,loading:g.value,class:"draft-btn"},{default:o(()=>[t(s,null,{default:o(()=>[t(b(ve))]),_:1}),e[17]||(e[17]=u(" 保存草稿 "))]),_:1,__:[17]},8,["loading"]),t(n,{type:"danger",onClick:j,loading:h.value,class:"delete-btn"},{default:o(()=>[t(s,null,{default:o(()=>[t(b(ye))]),_:1}),e[18]||(e[18]=u(" 删除文章 "))]),_:1,__:[18]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[Z,C.value]])]),_:1})])}}}),Xe=Ve(Re,[["__scopeId","data-v-62f79760"]]);export{Xe as default};
