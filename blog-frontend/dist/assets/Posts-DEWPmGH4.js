/* empty css             *//* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                *//* empty css                *//* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css                  */import{d as X,v as C,H as T,x as W,f as k,b as f,a as t,w as l,C as Z,X as ee,Q as _,e as n,j as te,g as $,a9 as ae,a2 as le,a3 as se,L as oe,K as ne,S as ie,T as re,aa as de,t as u,J as pe,N as ce,c as P,ab as ue,ac as me,D as _e,l as ge,F as fe,z as he,ad as ye,P as ve,q as be,ae as F,G as Ce,s as g,_ as ke}from"./index-BXzsnj2W.js";import{p as w}from"./posts-Yph_4swi.js";const we={class:"admin-posts"},Ee={class:"page-header"},xe={class:"table-actions"},ze={key:0},Be={class:"pagination"},Ve=X({__name:"Posts",setup(De){const h=be(),y=C([]),v=C(!1),m=C([]),r=T({search:"",status:""}),o=T({page:1,limit:10,total:0}),p=async()=>{v.value=!0;try{const s={page:o.page,limit:o.limit,search:r.search||void 0,status:r.status||void 0},e=await w.getList(s);e.data?(y.value=e.data.posts||e.data,o.total=e.data.total||0):(y.value=e.posts||e||[],o.total=e.total||e.length||0)}catch(s){_.error("获取文章列表失败"),console.error("获取文章列表失败:",s)}finally{v.value=!1}},E=()=>{o.page=1,p()},L=()=>{r.search="",r.status="",o.page=1,p()},M=s=>{o.limit=s,o.page=1,p()},N=s=>{o.page=s,p()},I=s=>{m.value=s},U=()=>{h.push("/admin/posts/create")},x=s=>{h.push(`/admin/posts/edit/${s.id}`)},Y=s=>{const e=h.resolve(`/posts/${s.id}`).href;window.open(e,"_blank")},j=async s=>{try{await F.confirm(`确定删除文章"${s.title}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await w.delete(s.id),_.success("删除成功"),p()}catch(e){e!=="cancel"&&(_.error("删除失败"),console.error("删除失败:",e))}},A=async()=>{if(m.value.length)try{await F.confirm(`确定删除选中的 ${m.value.length} 篇文章吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const s=m.value.map(e=>e.id);await w.batchDelete(s),_.success("批量删除成功"),p()}catch(s){s!=="cancel"&&(_.error("批量删除失败"),console.error("批量删除失败:",s))}},H=s=>Ce(s).format("YYYY-MM-DD HH:mm");return W(()=>{p()}),(s,e)=>{const z=te,c=Z,K=oe,b=se,B=re,R=ie,q=le,V=ee,d=ue,G=me,D=_e,J=ye,O=ve,Q=ce;return g(),k("div",we,[f("div",Ee,[e[5]||(e[5]=f("h1",null,"文章管理",-1)),t(c,{type:"primary",onClick:U},{default:l(()=>[t(z,null,{default:l(()=>[t($(ae))]),_:1}),e[4]||(e[4]=n(" 新建文章 "))]),_:1,__:[4]})]),t(V,{class:"search-card"},{default:l(()=>[t(q,{model:r,inline:""},{default:l(()=>[t(b,{label:"搜索"},{default:l(()=>[t(K,{modelValue:r.search,"onUpdate:modelValue":e[0]||(e[0]=a=>r.search=a),placeholder:"搜索文章标题或内容",clearable:"",onKeyup:ne(E,["enter"]),style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(b,{label:"状态"},{default:l(()=>[t(R,{modelValue:r.status,"onUpdate:modelValue":e[1]||(e[1]=a=>r.status=a),placeholder:"选择状态",clearable:"",style:{width:"120px"}},{default:l(()=>[t(B,{label:"已发布",value:"published"}),t(B,{label:"草稿",value:"draft"})]),_:1},8,["modelValue"])]),_:1}),t(b,null,{default:l(()=>[t(c,{type:"primary",onClick:E},{default:l(()=>e[6]||(e[6]=[n("搜索")])),_:1,__:[6]}),t(c,{onClick:L},{default:l(()=>e[7]||(e[7]=[n("重置")])),_:1,__:[7]})]),_:1})]),_:1},8,["model"])]),_:1}),f("div",xe,[t(c,{type:"danger",disabled:!m.value.length,onClick:A},{default:l(()=>[t(z,null,{default:l(()=>[t($(de))]),_:1}),n(" 批量删除 ("+u(m.value.length)+") ",1)]),_:1},8,["disabled"])]),t(V,null,{default:l(()=>[pe((g(),P(J,{data:y.value,onSelectionChange:I,style:{width:"100%"}},{default:l(()=>[t(d,{type:"selection",width:"55"}),t(d,{prop:"title",label:"标题","min-width":"200"},{default:l(({row:a})=>[t(G,{onClick:i=>x(a),type:"primary"},{default:l(()=>[n(u(a.title),1)]),_:2},1032,["onClick"])]),_:1}),t(d,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[t(D,{type:a.status==="published"?"success":"warning"},{default:l(()=>[n(u(a.status==="published"?"已发布":"草稿"),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"author",label:"作者",width:"120"},{default:l(({row:a})=>{var i,S;return[n(u(((i=a.author)==null?void 0:i.nickname)||((S=a.author)==null?void 0:S.username)||"-"),1)]}),_:1}),t(d,{prop:"category",label:"分类",width:"120"},{default:l(({row:a})=>{var i;return[n(u(((i=a.category)==null?void 0:i.name)||"-"),1)]}),_:1}),t(d,{prop:"tags",label:"标签",width:"150"},{default:l(({row:a})=>[(g(!0),k(fe,null,he(a.tags,i=>(g(),P(D,{key:i.id,size:"small",style:{"margin-right":"5px"}},{default:l(()=>[n(u(i.name),1)]),_:2},1024))),128)),!a.tags||!a.tags.length?(g(),k("span",ze,"-")):ge("",!0)]),_:1}),t(d,{prop:"createdAt",label:"创建时间",width:"180"},{default:l(({row:a})=>[n(u(H(a.createdAt)),1)]),_:1}),t(d,{label:"操作",width:"180",fixed:"right"},{default:l(({row:a})=>[t(c,{size:"small",onClick:i=>x(a)},{default:l(()=>e[8]||(e[8]=[n("编辑")])),_:2,__:[8]},1032,["onClick"]),t(c,{size:"small",onClick:i=>Y(a),type:"success"},{default:l(()=>e[9]||(e[9]=[n("预览")])),_:2,__:[9]},1032,["onClick"]),t(c,{size:"small",type:"danger",onClick:i=>j(a)},{default:l(()=>e[10]||(e[10]=[n("删除")])),_:2,__:[10]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,v.value]]),f("div",Be,[t(O,{"current-page":o.page,"onUpdate:currentPage":e[2]||(e[2]=a=>o.page=a),"page-size":o.limit,"onUpdate:pageSize":e[3]||(e[3]=a=>o.limit=a),"page-sizes":[10,20,50,100],total:o.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:N},null,8,["current-page","page-size","total"])])]),_:1})])}}}),Re=ke(Ve,[["__scopeId","data-v-5e1fcb46"]]);export{Re as default};
