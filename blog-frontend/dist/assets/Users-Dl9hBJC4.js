/* empty css             *//* empty css                   *//* empty css                   *//* empty css                 *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css                         *//* empty css                *//* empty css                *//* empty css                */import"./el-form-item-l0sNRNKZ.js";import{d as fe,v as w,H as B,x as ge,f as I,b as k,a,w as t,C as ve,X as be,an as we,Q as v,e as n,j as ye,g as P,a9 as Ve,a2 as ke,a3 as Ce,L as Ue,K as Ee,S as xe,T as Ie,F,z as M,c as C,J as he,N as ze,ab as De,ac as Re,t as y,D as Se,h as Te,aq as Be,k as Fe,m as Me,ad as Le,P as Ne,l as G,af as $e,ag as qe,ae as Ye,G as je,s as _,_ as Ae}from"./index-BXzsnj2W.js";import{a as U}from"./admin-DWljyYf4.js";const He={class:"admin-users"},Ke={class:"page-header"},Pe={class:"user-stats"},Ge={class:"pagination"},Je=fe({__name:"Users",setup(Oe){const L=w([]),h=w([]),z=w(!1),u=B({search:"",status:"",roleId:void 0}),i=B({page:1,limit:10,total:0}),V=w(!1),c=w("create"),D=w(!1),E=w(),s=B({username:"",email:"",password:"",status:"active",roleIds:[]}),N={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:50,message:"用户名长度在 2 到 50 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},f=async()=>{z.value=!0;try{const o={page:i.page,limit:i.limit,search:u.search||void 0,status:u.status||void 0,roleId:u.roleId||void 0},e=await U.getUsers(o);L.value=e.users,i.total=e.total}catch(o){v.error("获取用户列表失败"),console.error("获取用户列表失败:",o)}finally{z.value=!1}},J=async()=>{try{const o=await U.getRoles();h.value=o}catch(o){console.error("获取角色列表失败:",o)}},$=()=>{i.page=1,f()},O=()=>{u.search="",u.status="",u.roleId=void 0,i.page=1,f()},Q=o=>{i.limit=o,i.page=1,f()},X=o=>{i.page=o,f()},W=()=>{c.value="create",Y(),V.value=!0},q=o=>{c.value="edit",s.id=o.id,s.username=o.username,s.email=o.email,s.password="",s.nickname=o.nickname,s.avatar=o.avatar,s.status=o.status,s.roleIds=o.roles.map(e=>e.id),V.value=!0},Z=async(o,e)=>{try{await U.updateUser(o.id,{status:e}),v.success("状态更新成功"),f()}catch(r){v.error("状态更新失败"),console.error("状态更新失败:",r)}},ee=async o=>{var e,r;try{await Ye.confirm(`确定删除用户"${o.username}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await U.deleteUser(o.id),v.success("删除成功"),f()}catch(d){d!=="cancel"&&(v.error(((r=(e=d.response)==null?void 0:e.data)==null?void 0:r.message)||"删除失败"),console.error("删除失败:",d))}},ae=async()=>{var o,e;if(E.value)try{if(c.value==="edit"&&!s.password){const d={...N};delete d.password,E.value.clearValidate("password")}await E.value.validate(),D.value=!0;const r={...s};c.value==="edit"&&!r.password&&delete r.password,c.value==="create"?(await U.createUser(r),v.success("创建成功")):(await U.updateUser(s.id,r),v.success("更新成功")),V.value=!1,f()}catch(r){v.error(((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.message)||(c.value==="create"?"创建失败":"更新失败")),console.error("提交失败:",r)}finally{D.value=!1}},le=()=>{Y()},Y=()=>{var o;s.id=void 0,s.username="",s.email="",s.password="",s.nickname="",s.avatar="",s.status="active",s.roleIds=[],(o=E.value)==null||o.clearValidate()},te=o=>{switch(o){case"active":return"success";case"inactive":return"warning";case"banned":return"danger";default:return"info"}},oe=o=>{switch(o){case"active":return"正常";case"inactive":return"禁用";case"banned":return"封禁";default:return"未知"}},se=o=>{switch(o){case"super_admin":return"danger";case"admin":return"warning";case"editor":return"primary";case"user":return"info";default:return"info"}},ne=o=>je(o).format("YYYY-MM-DD HH:mm");return ge(()=>{J(),f()}),(o,e)=>{const r=ye,d=ve,b=Ue,m=Ce,x=Ie,R=xe,j=ke,A=be,re=Re,g=De,H=Se,S=Me,de=Fe,ue=Te,ie=Le,me=Ne,T=qe,pe=$e,ce=we,_e=ze;return _(),I("div",He,[k("div",Ke,[e[16]||(e[16]=k("h1",null,"用户管理",-1)),a(d,{type:"primary",onClick:W},{default:t(()=>[a(r,null,{default:t(()=>[a(P(Ve))]),_:1}),e[15]||(e[15]=n(" 新建用户 "))]),_:1,__:[15]})]),a(A,{class:"search-card"},{default:t(()=>[a(j,{model:u,inline:""},{default:t(()=>[a(m,{label:"搜索"},{default:t(()=>[a(b,{modelValue:u.search,"onUpdate:modelValue":e[0]||(e[0]=l=>u.search=l),placeholder:"搜索用户名或邮箱",clearable:"",onKeyup:Ee($,["enter"]),style:{width:"200px"}},null,8,["modelValue"])]),_:1}),a(m,{label:"状态"},{default:t(()=>[a(R,{modelValue:u.status,"onUpdate:modelValue":e[1]||(e[1]=l=>u.status=l),placeholder:"选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[a(x,{label:"正常",value:"active"}),a(x,{label:"禁用",value:"inactive"}),a(x,{label:"封禁",value:"banned"})]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"角色"},{default:t(()=>[a(R,{modelValue:u.roleId,"onUpdate:modelValue":e[2]||(e[2]=l=>u.roleId=l),placeholder:"选择角色",clearable:"",style:{width:"120px"}},{default:t(()=>[(_(!0),I(F,null,M(h.value,l=>(_(),C(x,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,null,{default:t(()=>[a(d,{type:"primary",onClick:$},{default:t(()=>e[17]||(e[17]=[n("搜索")])),_:1,__:[17]}),a(d,{onClick:O},{default:t(()=>e[18]||(e[18]=[n("重置")])),_:1,__:[18]})]),_:1})]),_:1},8,["model"])]),_:1}),a(A,null,{default:t(()=>[he((_(),C(ie,{data:L.value,style:{width:"100%"}},{default:t(()=>[a(g,{prop:"username",label:"用户名","min-width":"120"},{default:t(({row:l})=>[a(re,{onClick:p=>q(l),type:"primary"},{default:t(()=>[n(y(l.username),1)]),_:2},1032,["onClick"])]),_:1}),a(g,{prop:"email",label:"邮箱","min-width":"180"}),a(g,{prop:"nickname",label:"昵称","min-width":"120"}),a(g,{label:"角色","min-width":"150"},{default:t(({row:l})=>[(_(!0),I(F,null,M(l.roles,p=>(_(),C(H,{key:p.id,type:se(p.name),size:"small",style:{"margin-right":"4px"}},{default:t(()=>[n(y(p.name),1)]),_:2},1032,["type"]))),128))]),_:1}),a(g,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[a(H,{type:te(l.status),size:"small"},{default:t(()=>[n(y(oe(l.status)),1)]),_:2},1032,["type"])]),_:1}),a(g,{label:"统计",width:"120"},{default:t(({row:l})=>{var p,K;return[k("div",Pe,[k("span",null,y(((p=l._count)==null?void 0:p.posts)||0)+" 文章",1),k("span",null,y(((K=l._count)==null?void 0:K.comments)||0)+" 评论",1)])]}),_:1}),a(g,{prop:"createdAt",label:"注册时间",width:"180"},{default:t(({row:l})=>[n(y(ne(l.createdAt)),1)]),_:1}),a(g,{label:"操作",width:"200",fixed:"right"},{default:t(({row:l})=>[a(d,{size:"small",onClick:p=>q(l)},{default:t(()=>e[19]||(e[19]=[n("编辑")])),_:2,__:[19]},1032,["onClick"]),a(ue,{onCommand:p=>Z(l,p)},{dropdown:t(()=>[a(de,null,{default:t(()=>[a(S,{command:"active",disabled:l.status==="active"},{default:t(()=>e[21]||(e[21]=[n(" 激活 ")])),_:2,__:[21]},1032,["disabled"]),a(S,{command:"inactive",disabled:l.status==="inactive"},{default:t(()=>e[22]||(e[22]=[n(" 禁用 ")])),_:2,__:[22]},1032,["disabled"]),a(S,{command:"banned",disabled:l.status==="banned"},{default:t(()=>e[23]||(e[23]=[n(" 封禁 ")])),_:2,__:[23]},1032,["disabled"])]),_:2},1024)]),default:t(()=>[a(d,{size:"small",type:"warning"},{default:t(()=>[e[20]||(e[20]=n(" 状态 ")),a(r,null,{default:t(()=>[a(P(Be))]),_:1})]),_:1,__:[20]})]),_:2},1032,["onCommand"]),a(d,{size:"small",type:"danger",onClick:p=>ee(l)},{default:t(()=>e[24]||(e[24]=[n("删除")])),_:2,__:[24]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[_e,z.value]]),k("div",Ge,[a(me,{"current-page":i.page,"onUpdate:currentPage":e[3]||(e[3]=l=>i.page=l),"page-size":i.limit,"onUpdate:pageSize":e[4]||(e[4]=l=>i.limit=l),"page-sizes":[10,20,50,100],total:i.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Q,onCurrentChange:X},null,8,["current-page","page-size","total"])])]),_:1}),a(ce,{modelValue:V.value,"onUpdate:modelValue":e[14]||(e[14]=l=>V.value=l),title:c.value==="create"?"新建用户":"编辑用户",width:"600px",onClose:le},{footer:t(()=>[a(d,{onClick:e[13]||(e[13]=l=>V.value=!1)},{default:t(()=>e[28]||(e[28]=[n("取消")])),_:1,__:[28]}),a(d,{type:"primary",onClick:ae,loading:D.value},{default:t(()=>[n(y(c.value==="create"?"创建":"更新"),1)]),_:1},8,["loading"])]),default:t(()=>[a(j,{model:s,rules:N,ref_key:"formRef",ref:E,"label-width":"80px"},{default:t(()=>[a(m,{label:"用户名",prop:"username"},{default:t(()=>[a(b,{modelValue:s.username,"onUpdate:modelValue":e[5]||(e[5]=l=>s.username=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(m,{label:"邮箱",prop:"email"},{default:t(()=>[a(b,{modelValue:s.email,"onUpdate:modelValue":e[6]||(e[6]=l=>s.email=l),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),c.value==="create"?(_(),C(m,{key:0,label:"密码",prop:"password"},{default:t(()=>[a(b,{modelValue:s.password,"onUpdate:modelValue":e[7]||(e[7]=l=>s.password=l),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})):G("",!0),c.value==="edit"?(_(),C(m,{key:1,label:"新密码"},{default:t(()=>[a(b,{modelValue:s.password,"onUpdate:modelValue":e[8]||(e[8]=l=>s.password=l),type:"password",placeholder:"留空则不修改密码","show-password":""},null,8,["modelValue"])]),_:1})):G("",!0),a(m,{label:"昵称"},{default:t(()=>[a(b,{modelValue:s.nickname,"onUpdate:modelValue":e[9]||(e[9]=l=>s.nickname=l),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),a(m,{label:"头像URL"},{default:t(()=>[a(b,{modelValue:s.avatar,"onUpdate:modelValue":e[10]||(e[10]=l=>s.avatar=l),placeholder:"请输入头像URL"},null,8,["modelValue"])]),_:1}),a(m,{label:"状态",prop:"status"},{default:t(()=>[a(pe,{modelValue:s.status,"onUpdate:modelValue":e[11]||(e[11]=l=>s.status=l)},{default:t(()=>[a(T,{value:"active"},{default:t(()=>e[25]||(e[25]=[n("正常")])),_:1,__:[25]}),a(T,{value:"inactive"},{default:t(()=>e[26]||(e[26]=[n("禁用")])),_:1,__:[26]}),a(T,{value:"banned"},{default:t(()=>e[27]||(e[27]=[n("封禁")])),_:1,__:[27]})]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"角色",prop:"roleIds"},{default:t(()=>[a(R,{modelValue:s.roleIds,"onUpdate:modelValue":e[12]||(e[12]=l=>s.roleIds=l),multiple:"",placeholder:"请选择角色",style:{width:"100%"}},{default:t(()=>[(_(!0),I(F,null,M(h.value,l=>(_(),C(x,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),_a=Ae(Je,[["__scopeId","data-v-d52edb6e"]]);export{_a as default};
