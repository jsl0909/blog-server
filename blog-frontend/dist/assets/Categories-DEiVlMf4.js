/* empty css             *//* empty css                   *//* empty css                   *//* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css                 *//* empty css                *//* empty css                        *//* empty css                     *//* empty css               *//* empty css                *//* empty css                  */import{d as z,v as m,H as S,x as q,f as G,b as w,a as t,w as a,C as J,X as Q,an as X,Q as i,e as r,j as K,g as O,a9 as P,J as W,N as Z,c as ee,ab as te,ac as ae,t as _,D as le,ad as oe,a2 as ne,a3 as se,L as re,ae as ie,G as de,s as h,_ as ue}from"./index-BXzsnj2W.js";import{c as g}from"./categories-DKETdLTm.js";const ce={class:"admin-categories"},me={class:"page-header"},pe=z({__name:"Categories",setup(_e){const k=m([]),b=m(!1),d=m(!1),u=m("create"),C=m(!1),f=m(),n=S({name:"",description:""}),B={name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{min:1,max:50,message:"分类名称长度在 1 到 50 个字符",trigger:"blur"}]},y=async()=>{b.value=!0;try{const l=await g.getList();k.value=l||[]}catch(l){i.error("获取分类列表失败"),console.error("获取分类列表失败:",l)}finally{b.value=!1}},M=()=>{u.value="create",x(),d.value=!0},E=l=>{u.value="edit",n.id=l.id,n.name=l.name,n.description=l.description||"",d.value=!0},T=async l=>{var v;const e=((v=l._count)==null?void 0:v.posts)||0;if(e>0){i.warning(`该分类下还有 ${e} 篇文章，无法删除`);return}try{await ie.confirm(`确定删除分类"${l.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await g.delete(l.id),i.success("删除成功"),y()}catch(s){s!=="cancel"&&(i.error("删除失败"),console.error("删除失败:",s))}},$=async()=>{if(f.value)try{await f.value.validate(),C.value=!0,u.value==="create"?(await g.create(n),i.success("创建成功")):(await g.update(n.id,n),i.success("更新成功")),d.value=!1,y()}catch(l){i.error(u.value==="create"?"创建失败":"更新失败"),console.error("提交失败:",l)}finally{C.value=!1}},F=()=>{x()},x=()=>{var l;n.id=void 0,n.name="",n.description="",(l=f.value)==null||l.clearValidate()},I=l=>de(l).format("YYYY-MM-DD HH:mm");return q(()=>{y()}),(l,e)=>{const v=K,s=J,L=ae,p=te,N=le,Y=oe,A=Q,V=re,D=se,H=ne,R=X,U=Z;return h(),G("div",ce,[w("div",me,[e[5]||(e[5]=w("h1",null,"分类管理",-1)),t(s,{type:"primary",onClick:M},{default:a(()=>[t(v,null,{default:a(()=>[t(O(P))]),_:1}),e[4]||(e[4]=r(" 新建分类 "))]),_:1,__:[4]})]),t(A,null,{default:a(()=>[W((h(),ee(Y,{data:k.value,style:{width:"100%"}},{default:a(()=>[t(p,{prop:"name",label:"分类名称","min-width":"150"},{default:a(({row:o})=>[t(L,{onClick:c=>E(o),type:"primary"},{default:a(()=>[r(_(o.name),1)]),_:2},1032,["onClick"])]),_:1}),t(p,{prop:"description",label:"描述","min-width":"200"},{default:a(({row:o})=>[w("span",null,_(o.description||"-"),1)]),_:1}),t(p,{label:"文章数量",width:"120"},{default:a(({row:o})=>[t(N,{type:"info"},{default:a(()=>{var c;return[r(_(((c=o._count)==null?void 0:c.posts)||0)+" 篇",1)]}),_:2},1024)]),_:1}),t(p,{prop:"createdAt",label:"创建时间",width:"180"},{default:a(({row:o})=>[r(_(I(o.createdAt)),1)]),_:1}),t(p,{label:"操作",width:"150",fixed:"right"},{default:a(({row:o})=>{var c;return[t(s,{size:"small",onClick:j=>E(o)},{default:a(()=>e[6]||(e[6]=[r("编辑")])),_:2,__:[6]},1032,["onClick"]),t(s,{size:"small",type:"danger",onClick:j=>T(o),disabled:(((c=o._count)==null?void 0:c.posts)||0)>0},{default:a(()=>e[7]||(e[7]=[r(" 删除 ")])),_:2,__:[7]},1032,["onClick","disabled"])]}),_:1})]),_:1},8,["data"])),[[U,b.value]])]),_:1}),t(R,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=o=>d.value=o),title:u.value==="create"?"新建分类":"编辑分类",width:"500px",onClose:F},{footer:a(()=>[t(s,{onClick:e[2]||(e[2]=o=>d.value=!1)},{default:a(()=>e[8]||(e[8]=[r("取消")])),_:1,__:[8]}),t(s,{type:"primary",onClick:$,loading:C.value},{default:a(()=>[r(_(u.value==="create"?"创建":"更新"),1)]),_:1},8,["loading"])]),default:a(()=>[t(H,{model:n,rules:B,ref_key:"formRef",ref:f,"label-width":"80px"},{default:a(()=>[t(D,{label:"分类名称",prop:"name"},{default:a(()=>[t(V,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=o=>n.name=o),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),t(D,{label:"描述",prop:"description"},{default:a(()=>[t(V,{modelValue:n.description,"onUpdate:modelValue":e[1]||(e[1]=o=>n.description=o),type:"textarea",rows:4,placeholder:"请输入分类描述（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Me=ue(pe,[["__scopeId","data-v-c7124cbe"]]);export{Me as default};
