/* empty css             *//* empty css                   *//* empty css                *//* empty css               *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 */import"./el-form-item-l0sNRNKZ.js";/* empty css                 *//* empty css                  */import{d as M,v as i,H as j,x as z,f as v,a as t,w as a,X as G,J as H,N as J,c as b,a4 as O,a5 as Q,a3 as X,L as Z,af as K,ag as W,e as p,S as Y,F as R,z as U,T as ee,C as te,j as ae,g as c,a6 as le,Z as oe,a2 as re,b as B,$ as se,Q as m,q as ne,s as d,_ as ue}from"./index-BXzsnj2W.js";import{R as de}from"./RichEditor-Bq6E9r1x.js";import{p as L}from"./posts-Yph_4swi.js";import{c as ie}from"./categories-DKETdLTm.js";import{t as pe}from"./tags-Cn0cmVPH.js";const me={class:"create-post"},ce={class:"card-header"},fe=M({__name:"CreatePost",setup(_e){const y=ne(),f=i(),_=i(!1),u=i(!1),w=i([]),x=i([]),l=j({title:"",content:"",excerpt:"",status:"draft",categoryId:void 0,tagIds:[]}),q={title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:100,message:"标题长度在 1 到 100 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"}],status:[{required:!0,message:"请选择发布状态",trigger:"change"}]},V=r=>{const e=r.replace(/<[^>]*>/g,"");return e.length>150?e.substring(0,150)+"...":e},D=async()=>{var r,e;if(f.value)try{await f.value.validate(),u.value=!0;const s={...l,status:"published",excerpt:l.excerpt||V(l.content)};await L.create(s),m.success("文章创建成功"),y.push("/admin/posts")}catch(s){console.error("创建文章失败:",s),m.error(((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||"创建文章失败")}finally{u.value=!1}},F=async()=>{var r,e;if(!l.title.trim()){m.warning("请至少输入文章标题");return}try{u.value=!0;const s={...l,status:"draft",excerpt:l.excerpt||V(l.content)};await L.create(s),m.success("草稿保存成功"),y.push("/admin/posts")}catch(s){console.error("保存草稿失败:",s),m.error(((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||"保存草稿失败")}finally{u.value=!1}},N=async()=>{try{const r=await ie.getList();w.value=r.data.categories||r.data}catch(r){console.error("获取分类列表失败:",r)}},S=async()=>{try{const r=await pe.getList();x.value=r.data.tags||r.data}catch(r){console.error("获取标签列表失败:",r)}};return z(async()=>{_.value=!0;try{await Promise.all([N(),S()])}finally{_.value=!1}}),(r,e)=>{const s=ae,g=te,E=Z,n=X,C=Q,h=W,A=K,I=ee,k=Y,P=O,T=G,$=J;return d(),v("div",me,[t(T,null,{header:a(()=>[B("div",ce,[e[8]||(e[8]=B("span",null,"创建文章",-1)),t(g,{onClick:e[0]||(e[0]=o=>r.$router.go(-1)),type:"text"},{default:a(()=>[t(s,null,{default:a(()=>[t(c(se))]),_:1}),e[7]||(e[7]=p(" 返回 "))]),_:1,__:[7]})])]),default:a(()=>[H((d(),b(c(re),{ref_key:"formRef",ref:f,model:l,rules:q,"label-width":"80px"},{default:a(()=>[t(P,{gutter:20},{default:a(()=>[t(C,{span:16},{default:a(()=>[t(n,{label:"文章标题",prop:"title"},{default:a(()=>[t(E,{modelValue:l.title,"onUpdate:modelValue":e[1]||(e[1]=o=>l.title=o),placeholder:"请输入文章标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(n,{label:"文章内容",prop:"content"},{default:a(()=>[t(de,{modelValue:l.content,"onUpdate:modelValue":e[2]||(e[2]=o=>l.content=o),height:"500px",placeholder:"请输入文章内容..."},null,8,["modelValue"])]),_:1}),t(n,{label:"文章摘要"},{default:a(()=>[t(E,{modelValue:l.excerpt,"onUpdate:modelValue":e[3]||(e[3]=o=>l.excerpt=o),type:"textarea",rows:3,placeholder:"请输入文章摘要，留空则自动生成",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),t(C,{span:8},{default:a(()=>[t(n,{label:"发布状态",prop:"status"},{default:a(()=>[t(A,{modelValue:l.status,"onUpdate:modelValue":e[4]||(e[4]=o=>l.status=o)},{default:a(()=>[t(h,{value:"draft"},{default:a(()=>e[9]||(e[9]=[p("草稿")])),_:1,__:[9]}),t(h,{value:"published"},{default:a(()=>e[10]||(e[10]=[p("发布")])),_:1,__:[10]})]),_:1},8,["modelValue"])]),_:1}),t(n,{label:"文章分类"},{default:a(()=>[t(k,{modelValue:l.categoryId,"onUpdate:modelValue":e[5]||(e[5]=o=>l.categoryId=o),placeholder:"选择分类",clearable:"",style:{width:"100%"}},{default:a(()=>[(d(!0),v(R,null,U(w.value,o=>(d(),b(I,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(n,{label:"文章标签"},{default:a(()=>[t(k,{modelValue:l.tagIds,"onUpdate:modelValue":e[6]||(e[6]=o=>l.tagIds=o),multiple:"",placeholder:"选择标签",style:{width:"100%"}},{default:a(()=>[(d(!0),v(R,null,U(x.value,o=>(d(),b(I,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(n,null,{default:a(()=>[t(g,{type:"primary",onClick:D,loading:u.value},{default:a(()=>[t(s,null,{default:a(()=>[t(c(le))]),_:1}),e[11]||(e[11]=p(" 创建文章 "))]),_:1,__:[11]},8,["loading"]),t(g,{onClick:F,loading:u.value},{default:a(()=>[t(s,null,{default:a(()=>[t(c(oe))]),_:1}),e[12]||(e[12]=p(" 保存草稿 "))]),_:1,__:[12]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[$,_.value]])]),_:1})])}}}),qe=ue(fe,[["__scopeId","data-v-249eb710"]]);export{qe as default};
