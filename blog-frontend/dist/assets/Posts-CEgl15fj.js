/* empty css             *//* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                  */import{d as X,v as d,H as Z,x as ee,I as te,f as n,b as i,J as ae,l as C,a as s,w as r,K as se,L as oe,C as le,M as ne,N as re,O as ie,F as b,z as V,P as ce,Q as ue,j as de,g as v,R as q,e as p,S as pe,T as _e,c as E,t as c,U as me,V as ge,W as ve,D as he,q as fe,G as ye,s as o,_ as ke}from"./index-BXzsnj2W.js";import{p as Ce}from"./posts-Yph_4swi.js";import{c as be}from"./categories-DKETdLTm.js";import{t as Ve}from"./tags-Cn0cmVPH.js";const xe={class:"posts"},we={class:"page-header"},Ee={class:"header-actions"},Ie={class:"filters"},ze={class:"posts-container"},Se={key:0,class:"empty-state"},Ne={key:1,class:"posts-grid"},Pe=["onClick"],De={class:"post-header"},Le={class:"post-title"},Te={class:"post-meta"},Ue={class:"meta-item"},Be={class:"meta-item"},Me={key:0,class:"meta-item"},qe={class:"post-content"},Ae={key:0,class:"post-excerpt"},Re={key:1,class:"post-excerpt"},Ye={class:"post-footer"},je={class:"post-tags"},Fe={key:0,class:"more-tags"},Ke={key:0,class:"post-category"},He={key:0,class:"pagination-container"},Oe=X({__name:"Posts",setup(Qe){const A=fe(),x=te(),h=d([]),I=d([]),z=d([]),f=d(!1),m=d(""),g=d(""),y=d(""),l=Z({page:1,limit:12,total:0}),_=async()=>{f.value=!0;try{const t={page:l.page,limit:l.limit,search:m.value||void 0,status:"published",categoryId:g.value||void 0};t.categoryId&&(t.categoryId=Number(t.categoryId));const a=await Ce.getList(t);a.data?(h.value=a.data.posts||a.data||[],l.total=a.data.total||0):(h.value=[],l.total=0)}catch(t){console.error("获取文章列表失败:",t),ue.error("获取文章列表失败")}finally{f.value=!1}},R=async()=>{try{const t=await be.getList();I.value=t.data.categories||t.data||[]}catch(t){console.error("获取分类列表失败:",t)}},Y=async()=>{try{const t=await Ve.getList();z.value=t.data.tags||t.data||[]}catch(t){console.error("获取标签列表失败:",t)}},S=()=>{l.page=1,_()},N=()=>{l.page=1,_()},j=()=>{m.value="",g.value="",y.value="",l.page=1,_()},F=t=>{l.limit=t,l.page=1,_()},K=t=>{l.page=t,_()},H=t=>{A.push(`/posts/${t}`)},O=t=>ye(t).format("YYYY年MM月DD日"),P=t=>t.replace(/<[^>]*>/g,"");return ee(async()=>{const t=x.query.categoryId,a=x.query.tagId,u=x.query.search;t&&(g.value=Number(t)),a&&(y.value=Number(a)),u&&(m.value=String(u)),await Promise.all([R(),Y(),_()])}),(t,a)=>{const u=de,Q=oe,D=le,k=_e,L=pe,$=ne,G=ie,T=he,J=ce,W=re;return o(),n("div",xe,[i("div",we,[a[6]||(a[6]=i("h1",null,"文章列表",-1)),i("div",Ee,[s(Q,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),placeholder:"搜索文章...",clearable:"",onKeyup:se(S,["enter"]),class:"search-input"},{prefix:r(()=>[s(u,null,{default:r(()=>[s(v(q))]),_:1})]),_:1},8,["modelValue"]),s(D,{onClick:S,type:"primary"},{default:r(()=>[s(u,null,{default:r(()=>[s(v(q))]),_:1}),a[5]||(a[5]=p(" 搜索 "))]),_:1,__:[5]})])]),i("div",Ie,[s($,{wrap:""},{default:r(()=>[s(L,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value=e),placeholder:"选择分类",clearable:"",onChange:N},{default:r(()=>[s(k,{label:"全部分类",value:""}),(o(!0),n(b,null,V(I.value,e=>(o(),E(k,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(L,{modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=e=>y.value=e),placeholder:"选择标签",clearable:"",onChange:N},{default:r(()=>[s(k,{label:"全部标签",value:""}),(o(!0),n(b,null,V(z.value,e=>(o(),E(k,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(D,{onClick:j,text:""},{default:r(()=>a[7]||(a[7]=[p("重置筛选")])),_:1,__:[7]})]),_:1})]),ae((o(),n("div",ze,[h.value.length===0&&!f.value?(o(),n("div",Se,[s(G,{description:"暂无文章"})])):(o(),n("div",Ne,[(o(!0),n(b,null,V(h.value,e=>{var U,B,M;return o(),n("article",{key:e.id,class:"post-card",onClick:w=>H(e.id)},[i("div",De,[i("h3",Le,c(e.title),1),i("div",Te,[i("span",Ue,[s(u,null,{default:r(()=>[s(v(me))]),_:1}),p(" "+c(((U=e.author)==null?void 0:U.nickname)||((B=e.author)==null?void 0:B.username)||"匿名"),1)]),i("span",Be,[s(u,null,{default:r(()=>[s(v(ge))]),_:1}),p(" "+c(O(e.createdAt)),1)]),e.viewCount?(o(),n("span",Me,[s(u,null,{default:r(()=>[s(v(ve))]),_:1}),p(" "+c(e.viewCount),1)])):C("",!0)])]),i("div",qe,[e.excerpt?(o(),n("p",Ae,c(e.excerpt),1)):(o(),n("p",Re,c(P(e.content).substring(0,150))+c(P(e.content).length>150?"...":""),1))]),i("div",Ye,[i("div",je,[(o(!0),n(b,null,V((M=e.tags)==null?void 0:M.slice(0,3),w=>(o(),E(T,{key:w.id,size:"small",class:"tag-item"},{default:r(()=>[p(c(w.name),1)]),_:2},1024))),128)),e.tags&&e.tags.length>3?(o(),n("span",Fe," +"+c(e.tags.length-3),1)):C("",!0)]),e.category?(o(),n("div",Ke,[s(T,{type:"info",size:"small"},{default:r(()=>[p(c(e.category.name),1)]),_:2},1024)])):C("",!0)])],8,Pe)}),128))]))])),[[W,f.value]]),l.total>0?(o(),n("div",He,[s(J,{"current-page":l.page,"onUpdate:currentPage":a[3]||(a[3]=e=>l.page=e),"page-size":l.limit,"onUpdate:pageSize":a[4]||(a[4]=e=>l.limit=e),"page-sizes":[12,24,48],total:l.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:F,onCurrentChange:K},null,8,["current-page","page-size","total"])])):C("",!0)])}}}),nt=ke(Oe,[["__scopeId","data-v-12c5167d"]]);export{nt as default};
