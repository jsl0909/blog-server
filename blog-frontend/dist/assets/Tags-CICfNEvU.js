/* empty css             *//* empty css                   *//* empty css                   *//* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css                 *//* empty css                *//* empty css                        *//* empty css                     *//* empty css               *//* empty css                *//* empty css                  */import{d as j,v as m,H as S,x as q,f as G,b as w,a as e,w as a,C as J,X as Q,an as X,Q as i,e as r,j as K,g as O,a9 as P,J as W,N as Z,c as ee,ab as te,ac as ae,D as le,t as _,ad as oe,a2 as ne,a3 as se,L as re,ae as ie,G as de,s as h,_ as ue}from"./index-BXzsnj2W.js";import{t as g}from"./tags-Cn0cmVPH.js";const ce={class:"admin-tags"},me={class:"page-header"},pe=j({__name:"Tags",setup(_e){const k=m([]),b=m(!1),d=m(!1),u=m("create"),y=m(!1),f=m(),n=S({name:"",description:""}),B={name:[{required:!0,message:"请输入标签名称",trigger:"blur"},{min:1,max:30,message:"标签名称长度在 1 到 30 个字符",trigger:"blur"}]},C=async()=>{b.value=!0;try{const l=await g.getList();k.value=l||[]}catch(l){i.error("获取标签列表失败"),console.error("获取标签列表失败:",l)}finally{b.value=!1}},M=()=>{u.value="create",x(),d.value=!0},E=l=>{u.value="edit",n.id=l.id,n.name=l.name,n.description=l.description||"",d.value=!0},$=async l=>{var v;const t=((v=l._count)==null?void 0:v.posts)||0;if(t>0){i.warning(`该标签下还有 ${t} 篇文章，无法删除`);return}try{await ie.confirm(`确定删除标签"${l.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await g.delete(l.id),i.success("删除成功"),C()}catch(s){s!=="cancel"&&(i.error("删除失败"),console.error("删除失败:",s))}},F=async()=>{if(f.value)try{await f.value.validate(),y.value=!0,u.value==="create"?(await g.create(n),i.success("创建成功")):(await g.update(n.id,n),i.success("更新成功")),d.value=!1,C()}catch(l){i.error(u.value==="create"?"创建失败":"更新失败"),console.error("提交失败:",l)}finally{y.value=!1}},I=()=>{x()},x=()=>{var l;n.id=void 0,n.name="",n.description="",(l=f.value)==null||l.clearValidate()},L=l=>de(l).format("YYYY-MM-DD HH:mm");return q(()=>{C()}),(l,t)=>{const v=K,s=J,V=le,N=ae,p=te,Y=oe,z=Q,D=re,T=se,A=ne,H=X,R=Z;return h(),G("div",ce,[w("div",me,[t[5]||(t[5]=w("h1",null,"标签管理",-1)),e(s,{type:"primary",onClick:M},{default:a(()=>[e(v,null,{default:a(()=>[e(O(P))]),_:1}),t[4]||(t[4]=r(" 新建标签 "))]),_:1,__:[4]})]),e(z,null,{default:a(()=>[W((h(),ee(Y,{data:k.value,style:{width:"100%"}},{default:a(()=>[e(p,{prop:"name",label:"标签名称","min-width":"150"},{default:a(({row:o})=>[e(N,{onClick:c=>E(o),type:"primary"},{default:a(()=>[e(V,{size:"large"},{default:a(()=>[r(_(o.name),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:1}),e(p,{prop:"description",label:"描述","min-width":"200"},{default:a(({row:o})=>[w("span",null,_(o.description||"-"),1)]),_:1}),e(p,{label:"文章数量",width:"120"},{default:a(({row:o})=>[e(V,{type:"info"},{default:a(()=>{var c;return[r(_(((c=o._count)==null?void 0:c.posts)||0)+" 篇",1)]}),_:2},1024)]),_:1}),e(p,{prop:"createdAt",label:"创建时间",width:"180"},{default:a(({row:o})=>[r(_(L(o.createdAt)),1)]),_:1}),e(p,{label:"操作",width:"150",fixed:"right"},{default:a(({row:o})=>{var c;return[e(s,{size:"small",onClick:U=>E(o)},{default:a(()=>t[6]||(t[6]=[r("编辑")])),_:2,__:[6]},1032,["onClick"]),e(s,{size:"small",type:"danger",onClick:U=>$(o),disabled:(((c=o._count)==null?void 0:c.posts)||0)>0},{default:a(()=>t[7]||(t[7]=[r(" 删除 ")])),_:2,__:[7]},1032,["onClick","disabled"])]}),_:1})]),_:1},8,["data"])),[[R,b.value]])]),_:1}),e(H,{modelValue:d.value,"onUpdate:modelValue":t[3]||(t[3]=o=>d.value=o),title:u.value==="create"?"新建标签":"编辑标签",width:"500px",onClose:I},{footer:a(()=>[e(s,{onClick:t[2]||(t[2]=o=>d.value=!1)},{default:a(()=>t[8]||(t[8]=[r("取消")])),_:1,__:[8]}),e(s,{type:"primary",onClick:F,loading:y.value},{default:a(()=>[r(_(u.value==="create"?"创建":"更新"),1)]),_:1},8,["loading"])]),default:a(()=>[e(A,{model:n,rules:B,ref_key:"formRef",ref:f,"label-width":"80px"},{default:a(()=>[e(T,{label:"标签名称",prop:"name"},{default:a(()=>[e(D,{modelValue:n.name,"onUpdate:modelValue":t[0]||(t[0]=o=>n.name=o),placeholder:"请输入标签名称"},null,8,["modelValue"])]),_:1}),e(T,{label:"描述",prop:"description"},{default:a(()=>[e(D,{modelValue:n.description,"onUpdate:modelValue":t[1]||(t[1]=o=>n.description=o),type:"textarea",rows:4,placeholder:"请输入标签描述（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Be=ue(pe,[["__scopeId","data-v-e2d5cf54"]]);export{Be as default};
