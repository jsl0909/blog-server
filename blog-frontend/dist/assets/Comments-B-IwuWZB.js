/* empty css             *//* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                *//* empty css                *//* empty css                  */import"./el-form-item-l0sNRNKZ.js";import{am as _,d as ee,v as B,H as $,x as te,f as A,b as d,a,w as s,X as ae,C as ne,Q as r,a2 as se,a3 as oe,S as le,T as ce,e as u,j as re,g as T,ao as ie,t as p,ap as de,aa as ue,J as pe,N as me,c as E,ab as _e,l as S,D as ge,ad as he,P as fe,ae as C,G as ve,s as y,_ as ye}from"./index-BXzsnj2W.js";const g={getList:l=>_.get("/comments",{params:l}),getById:l=>_.get(`/comments/${l}`),updateStatus:(l,b)=>_.patch(`/comments/${l}/status`,b),delete:l=>_.delete(`/comments/${l}`),batchDelete:l=>_.post("/comments/batch-delete",{ids:l}),batchApprove:l=>_.post("/comments/batch-approve",{ids:l}),batchReject:l=>_.post("/comments/batch-reject",{ids:l})},be={class:"admin-comments"},Ce={class:"table-actions"},we={class:"comment-content"},xe={class:"content"},ke={class:"meta"},Be={class:"author"},Te={class:"post-title"},Ee={key:0,class:"reply-to"},Se={class:"pagination"},je=ee({__name:"Comments",setup(l){const b=B([]),w=B(!1),o=B([]),h=$({status:""}),c=$({page:1,limit:10,total:0}),i=async()=>{w.value=!0;try{const t={page:c.page,limit:c.limit,status:h.status||void 0},e=await g.getList(t);b.value=e.data||e||[],c.total=e.total||e.length||0}catch(t){r.error("获取评论列表失败"),console.error("获取评论列表失败:",t)}finally{w.value=!1}},V=()=>{c.page=1,i()},M=()=>{h.status="",c.page=1,i()},N=t=>{c.limit=t,c.page=1,i()},R=t=>{c.page=t,i()},I=t=>{o.value=t},Y=async t=>{try{await g.updateStatus(t.id,{status:"approved"}),r.success("审核通过"),i()}catch(e){r.error("操作失败"),console.error("审核失败:",e)}},F=async t=>{try{await g.updateStatus(t.id,{status:"rejected"}),r.success("已拒绝"),i()}catch(e){r.error("操作失败"),console.error("拒绝失败:",e)}},H=async t=>{try{await C.confirm("确定删除这条评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await g.delete(t.id),r.success("删除成功"),i()}catch(e){e!=="cancel"&&(r.error("删除失败"),console.error("删除失败:",e))}},L=async()=>{if(o.value.length)try{await C.confirm(`确定通过选中的 ${o.value.length} 条评论吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"});const t=o.value.map(e=>e.id);await g.batchApprove(t),r.success("批量审核通过"),i()}catch(t){t!=="cancel"&&(r.error("批量操作失败"),console.error("批量通过失败:",t))}},P=async()=>{if(o.value.length)try{await C.confirm(`确定拒绝选中的 ${o.value.length} 条评论吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=o.value.map(e=>e.id);await g.batchReject(t),r.success("批量拒绝成功"),i()}catch(t){t!=="cancel"&&(r.error("批量操作失败"),console.error("批量拒绝失败:",t))}},U=async()=>{if(o.value.length)try{await C.confirm(`确定删除选中的 ${o.value.length} 条评论吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=o.value.map(e=>e.id);await g.batchDelete(t),r.success("批量删除成功"),i()}catch(t){t!=="cancel"&&(r.error("批量删除失败"),console.error("批量删除失败:",t))}},q=t=>{switch(t){case"approved":return"success";case"rejected":return"danger";case"pending":return"warning";default:return"info"}},G=t=>{switch(t){case"approved":return"已通过";case"rejected":return"已拒绝";case"pending":return"待审核";default:return"未知"}},J=t=>ve(t).format("YYYY-MM-DD HH:mm");return te(()=>{i()}),(t,e)=>{const x=ce,O=le,j=oe,m=ne,Q=se,z=ae,k=re,f=_e,X=ge,K=he,W=fe,Z=me;return y(),A("div",be,[e[9]||(e[9]=d("div",{class:"page-header"},[d("h1",null,"评论管理")],-1)),a(z,{class:"search-card"},{default:s(()=>[a(Q,{model:h,inline:""},{default:s(()=>[a(j,{label:"状态"},{default:s(()=>[a(O,{modelValue:h.status,"onUpdate:modelValue":e[0]||(e[0]=n=>h.status=n),placeholder:"选择状态",clearable:"",style:{width:"120px"}},{default:s(()=>[a(x,{label:"待审核",value:"pending"}),a(x,{label:"已通过",value:"approved"}),a(x,{label:"已拒绝",value:"rejected"})]),_:1},8,["modelValue"])]),_:1}),a(j,null,{default:s(()=>[a(m,{type:"primary",onClick:V},{default:s(()=>e[3]||(e[3]=[u("搜索")])),_:1,__:[3]}),a(m,{onClick:M},{default:s(()=>e[4]||(e[4]=[u("重置")])),_:1,__:[4]})]),_:1})]),_:1},8,["model"])]),_:1}),d("div",Ce,[a(m,{type:"success",disabled:!o.value.length,onClick:L},{default:s(()=>[a(k,null,{default:s(()=>[a(T(ie))]),_:1}),u(" 批量通过 ("+p(o.value.length)+") ",1)]),_:1},8,["disabled"]),a(m,{type:"warning",disabled:!o.value.length,onClick:P},{default:s(()=>[a(k,null,{default:s(()=>[a(T(de))]),_:1}),u(" 批量拒绝 ("+p(o.value.length)+") ",1)]),_:1},8,["disabled"]),a(m,{type:"danger",disabled:!o.value.length,onClick:U},{default:s(()=>[a(k,null,{default:s(()=>[a(T(ue))]),_:1}),u(" 批量删除 ("+p(o.value.length)+") ",1)]),_:1},8,["disabled"])]),a(z,null,{default:s(()=>[pe((y(),E(K,{data:b.value,onSelectionChange:I,style:{width:"100%"}},{default:s(()=>[a(f,{type:"selection",width:"55"}),a(f,{label:"评论内容","min-width":"300"},{default:s(({row:n})=>{var v,D;return[d("div",we,[d("div",xe,p(n.content),1),d("div",ke,[d("span",Be,p(((v=n.author)==null?void 0:v.name)||"匿名用户"),1),e[5]||(e[5]=d("span",{class:"divider"},"·",-1)),d("span",Te,p(((D=n.post)==null?void 0:D.title)||"未知文章"),1)]),n.parent?(y(),A("div",Ee," 回复："+p(n.parent.author.name)+" - "+p(n.parent.content.slice(0,50))+"... ",1)):S("",!0)])]}),_:1}),a(f,{prop:"status",label:"状态",width:"100"},{default:s(({row:n})=>[a(X,{type:q(n.status),size:"small"},{default:s(()=>[u(p(G(n.status)),1)]),_:2},1032,["type"])]),_:1}),a(f,{prop:"createdAt",label:"评论时间",width:"180"},{default:s(({row:n})=>[u(p(J(n.createdAt)),1)]),_:1}),a(f,{label:"操作",width:"200",fixed:"right"},{default:s(({row:n})=>[n.status==="pending"?(y(),E(m,{key:0,size:"small",type:"success",onClick:v=>Y(n)},{default:s(()=>e[6]||(e[6]=[u(" 通过 ")])),_:2,__:[6]},1032,["onClick"])):S("",!0),n.status==="pending"?(y(),E(m,{key:1,size:"small",type:"warning",onClick:v=>F(n)},{default:s(()=>e[7]||(e[7]=[u(" 拒绝 ")])),_:2,__:[7]},1032,["onClick"])):S("",!0),a(m,{size:"small",type:"danger",onClick:v=>H(n)},{default:s(()=>e[8]||(e[8]=[u(" 删除 ")])),_:2,__:[8]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,w.value]]),d("div",Se,[a(W,{"current-page":c.page,"onUpdate:currentPage":e[1]||(e[1]=n=>c.page=n),"page-size":c.limit,"onUpdate:pageSize":e[2]||(e[2]=n=>c.limit=n),"page-sizes":[10,20,50,100],total:c.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:N,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),_:1})])}}}),Pe=ye(je,[["__scopeId","data-v-8b083130"]]);export{Pe as default};
