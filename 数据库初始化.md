 # 数据库初始化说明

## 🗄️ 数据库配置

### 1. 创建数据库

```sql
-- 登录MySQL
mysql -u root -p

-- 创建数据库
CREATE DATABASE blog_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 创建用户（可选）
CREATE USER 'blog_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON blog_db.* TO 'blog_user'@'localhost';
FLUSH PRIVILEGES;
```

### 2. 配置环境变量

复制环境变量文件：
```bash
cp blog-backend/.env.example blog-backend/.env
```

修改 `blog-backend/.env` 文件：
```env
# 数据库配置（修改为你的数据库信息）
DATABASE_URL="mysql://root:your_password@localhost:3306/blog_db"

# JWT 密钥（生产环境请修改）
JWT_SECRET="your-secret-key-change-this-in-production"
JWT_EXPIRES_IN="7d"

# 服务器配置
PORT=3000
NODE_ENV=development

# CORS 配置
CORS_ORIGIN="http://localhost:5173"
```

### 3. 运行数据库迁移

```bash
cd blog-backend

# 生成Prisma客户端
npm run prisma:generate

# 运行数据库迁移
npm run prisma:migrate

# 初始化种子数据
npm run prisma:seed
```

## 📊 初始化数据

运行种子脚本后，系统会自动创建：

### 👥 用户角色
- **超级管理员** (super_admin)
- **管理员** (admin) 
- **编辑** (editor)
- **普通用户** (user)

### 👤 默认账号
- **邮箱**: admin@blog.com
- **密码**: admin123456
- **角色**: 超级管理员

### 📂 默认分类
- 技术分享
- 生活随笔
- 学习笔记

### 🏷️ 默认标签
- JavaScript
- TypeScript
- Vue
- React
- Node.js
- MySQL

### ⚙️ 系统配置
- 网站名称：我的博客
- 网站描述：一个基于NestJS和Vue的博客系统
- 每页文章数量：10

## 🔧 常用命令

```bash
# 查看数据库状态
npm run prisma:studio

# 重置数据库
npm run prisma:migrate reset

# 重新运行种子数据
npm run prisma:seed

# 生成新的迁移文件
npm run prisma:migrate dev --name "migration_name"
```

## ⚠️ 注意事项

1. **生产环境**：请修改默认的JWT密钥和超级管理员密码
2. **数据库权限**：确保数据库用户有足够的权限创建表和索引
3. **字符集**：建议使用 `utf8mb4` 字符集支持emoji和特殊字符
4. **备份**：生产环境中定期备份数据库

## 🆘 常见问题

### Q: 数据库连接失败
A: 检查以下内容：
- MySQL服务是否启动
- 数据库连接信息是否正确
- 用户权限是否足够
- 防火墙是否阻止连接

### Q: 迁移失败
A: 尝试以下解决方案：
- 删除 `prisma/migrations` 目录重新迁移
- 检查数据库用户权限
- 查看具体错误信息

### Q: 种子数据重复
A: 种子脚本使用 `upsert` 操作，可以安全地重复运行